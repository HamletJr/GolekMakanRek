<!-- templates/forum/show_post.html -->
{% extends 'base-forum.html' %}
{% load static %}

{% block title %}Forum - Jelajahi Makanan di Surabaya!{% endblock %}

{% block content %}
<main>
    <section class="post-list">
        {% for post in page_obj %}
        <article class="bg-white rounded-lg shadow-md mb-5 p-5">
            <div class="flex items-center mb-2.5">
                <img src="{% if post.user.profile_image %}{{ post.user.profile_image.url }}{% else %}{% static 'image/user-pic-default.png' %}{% endif %}" alt="User Profile" class="rounded-full w-12 h-12 mr-4">
                <div class="user-info">
                    <p class="text-lg font-bold m-0">{{ post.user.username }}</p>
                    <p class="text-base text-gray-600 m-0">{{ post.created_at|timesince }} ago</p>
                </div>
            </div>
            <div class="text-base mt-1">
                {% if post.restaurant %}
                    <p><strong>Restoran:</strong> {{ post.restaurant.nama }}</p>
                {% endif %}
                <p>{{ post.text }}</p>
                {% if post.image %}
                    <img src="{{ post.image.url }}" alt="Post Image" class="mt-4 rounded-lg max-w-full">
                {% endif %}
            </div>
            <div class="flex justify-around mt-4 border-t border-gray-200 pt-2.5">
                <button onclick="handleLike({{ post.id }})" id="like-btn-{{ post.id }}" class="flex items-center {% if post.id in user_liked_posts %}liked{% else %}unliked{% endif %}">
                    <i class="fas fa-thumbs-up mr-2"></i> Like
                </button>
                <button onclick="toggleComments({{ post.id }})" class="flex items-center">
                    <i class="fas fa-comment mr-1.5"></i> Comment
                </button>
                <button onclick="handleShare('{{ request.build_absolute_uri }}')" class="flex items-center">
                    <i class="fas fa-share mr-1.5"></i> Share
                </button>
                <button onclick="showReportModal({{ post.id }})" class="flex items-center">
                    <i class="fas fa-flag mr-1.5"></i> Laporkan
                </button>
            </div>
            <div id="comments-{{ post.id }}" class="comments-section hidden">
                <h4 class="text-lg font-bold mb-2">Comments</h4>
                <div class="existing-comments space-y-2 mb-4">
                    {% for comment in post.comments.all %}
                        <p><strong>{{ comment.user.username }}:</strong> {{ comment.text }}</p>
                    {% empty %}
                        <p>No comments yet.</p>
                    {% endfor %}
                </div>
                <form class="comment-form space-y-2" onsubmit="postComment(event, {{ post.id }})">
                    <textarea name="comment" placeholder="Add a comment..." required class="w-full p-2 mb-2 rounded border border-gray-300"></textarea>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded cursor-pointer">
                        Post Comment
                    </button>
                </form>
            </div>
            <div id="report-modal-{{ post.id }}" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
                <div class="bg-white p-5 rounded-lg shadow-md w-80">
                    <h4 class="text-lg font-bold mb-4">Laporkan Postingan</h4>
                    <form class="report-form space-y-4">
                        <select id="report-reason-{{ post.id }}" class="w-full p-2 border rounded">
                            <option value="Konten Tidak Pantas">Konten Tidak Pantas</option>
                            <option value="Spam atau Iklan">Spam atau Iklan</option>
                            <option value="Bahasa Kasar atau Menyinggung">Bahasa Kasar atau Menyinggung</option>
                            <option value="Misinformasi">Misinformasi</option>
                            <option value="Topik Tidak Relevan">Topik Tidak Relevan</option>
                        </select>
                        <div class="flex justify-between">
                            <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded cursor-pointer" onclick="closeReportModal({{ post.id }})">Batal</button>
                            <button type="button" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded cursor-pointer" onclick="submitReport({{ post.id }})">Kirim</button>
                        </div>
                    </form>
                </div>
            </div>
        </article>
        {% empty %}
        <p class="text-center">Tidak ada postingan tersedia.</p>
        {% endfor %}
    </section>
    <div class="pagination text-center mt-8">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1" class="px-3 py-1 bg-green-600 text-white rounded">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}" class="px-3 py-1 bg-green-600 text-white rounded">previous</a>
            {% endif %}
            <span class="current mx-2">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="px-3 py-1 bg-green-600 text-white rounded">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}" class="px-3 py-1 bg-green-600 text-white rounded">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</main>
{% endblock %}
